/*
Auth'n'Auth User Token
Token for: jc.daguila945
Expires: Thu, 29 Jun 2023 18:01:20 GMT
AgAAAA**AQAAAA**aAAAAA**8NzVYQ**nY+sHZ2PrBmdj6wVnY+sEZ2PrA2dj6AMmIeoAJKCqAydj6x9nY+seQ**l98GAA**AAMAAA**dD4CSLi9llacRIoBDmYA7P8tlQk/jqDIup6wAGDFFfjU4m3VmYgASXYIgFzHy1CTtwO96bBE7L83tTjCv+exyZ92h8XtJs3Xr9DcfD9H48Je5fUHMAuvj6K9/Phbk/SaMCveRXOrjclmOdQJjxc+YZzZxDmVmDjSTUjIGy+ocjpQqtxim/zhr8LesZVswWhk1t4U25LtrfhR54kTcIXmDGH+QeIpSwMKiV05ko9I5bNDOfE+Qflf/7HC1Nox0gEGxasTMOr3aiqmlLNmZO8SSJPfsb+65NikL4omAbentpLGh+I2b/x1Sy9sVl8G2J6GEsmRtSy2T5j5EfoKBiTinYUXcVFJaqDoKKUw9bzcRYFaCbDe0GqNZRImrlsYSN8rHhYHMmnzCZ++xPxxIAGjYoSJPLJ1TwuwvJ3Qpc8I1v6tJIn1d7n1qW2usAxlLkrVgeynRkzbvtS/+ELNS+UUCFHOcFzb7MGF9VHHlbEOkBo4erk8atEDMNAZoFAuHGPYfizaoo9prLtFRWLjXHOO5WeK8nrQNlmeVXqljEWG8bkWVwzLtalsWqWvdgcGQ8ObhB4v5j0ZmQlClGBa/iZ4f445hoNgr8r+7qSTO1pVStLjZbyMawn4y84HAbdAov0hV78b8L9oVgE8eig0OaFG5QxFeF+a4DdESS06aQ8OfZsTfPVTVgjOA1p/0aNfrQpUJbn9ijSIUCCC8HzIW7K/J+CaoaLJB3goG52iw1Zca4Zb32EvqZrwV/CpGDRxZq6d
*/


const userToken='AgAAAA**AQAAAA**aAAAAA**8NzVYQ**nY+sHZ2PrBmdj6wVnY+sEZ2PrA2dj6AMmIeoAJKCqAydj6x9nY+seQ**l98GAA**AAMAAA**dD4CSLi9llacRIoBDmYA7P8tlQk/jqDIup6wAGDFFfjU4m3VmYgASXYIgFzHy1CTtwO96bBE7L83tTjCv+exyZ92h8XtJs3Xr9DcfD9H48Je5fUHMAuvj6K9/Phbk/SaMCveRXOrjclmOdQJjxc+YZzZxDmVmDjSTUjIGy+ocjpQqtxim/zhr8LesZVswWhk1t4U25LtrfhR54kTcIXmDGH+QeIpSwMKiV05ko9I5bNDOfE+Qflf/7HC1Nox0gEGxasTMOr3aiqmlLNmZO8SSJPfsb+65NikL4omAbentpLGh+I2b/x1Sy9sVl8G2J6GEsmRtSy2T5j5EfoKBiTinYUXcVFJaqDoKKUw9bzcRYFaCbDe0GqNZRImrlsYSN8rHhYHMmnzCZ++xPxxIAGjYoSJPLJ1TwuwvJ3Qpc8I1v6tJIn1d7n1qW2usAxlLkrVgeynRkzbvtS/+ELNS+UUCFHOcFzb7MGF9VHHlbEOkBo4erk8atEDMNAZoFAuHGPYfizaoo9prLtFRWLjXHOO5WeK8nrQNlmeVXqljEWG8bkWVwzLtalsWqWvdgcGQ8ObhB4v5j0ZmQlClGBa/iZ4f445hoNgr8r+7qSTO1pVStLjZbyMawn4y84HAbdAov0hV78b8L9oVgE8eig0OaFG5QxFeF+a4DdESS06aQ8OfZsTfPVTVgjOA1p/0aNfrQpUJbn9ijSIUCCC8HzIW7K/J+CaoaLJB3goG52iw1Zca4Zb32EvqZrwV/CpGDRxZq6d';
//const appToken='v^1.1#i^1#p^1#r^0#f^0#I^3#t^H4sIAAAAAAAAAOVYa2wUVRTutttCpUUIIISI2U5BjXVm78zs7GNkV7ddHltLu7JLI1UkszN36NDZmWHmDksNkKYGoik/EKPxj7LgC36IYBRDCQGMaNSooYkmJj4Sog1ia3wREhIT7+wuZVsJIN3EJu6fzZx77rnf951z7r0zoK+m9r6dK3deqndNq8z1gb5Kl4ueAWprqptmVlUurK4AJQ6uXN/iPnd/1fmllpBRDX41tAxds6BnS0bVLD5vDBO2qfG6YCkWrwkZaPFI5JPRVW08QwHeMHWki7pKeOKxMOHn/CAdAGKaEUWZZhhs1a7ETOlhQg7SrCDBAJ2GHP6X8Lhl2TCuWUjQUJhgAMOQgCYBl6IDPMvyNE1xgUAX4emEpqXoGnahABHJw+Xzc80SrNeHKlgWNBEOQkTi0eXJjmg8tqw9tdRbEitS1CGJBGRb459adAl6OgXVhtdfxsp780lbFKFlEd5IYYXxQfnoFTC3AD8vtZRmWS4UTDMSgLQkwbJIuVw3MwK6Pg7HokiknHfloYYU1HsjRbEa6Y1QRMWndhwiHvM4f4/YgqrICjTDxLLm6NpoIkFEWm1VwWKrZNQwVEXQRDKxOkaGIEzTIsOxpCQykp/l5OJChWhFmSes1KJrkuKIZnnaddQMMWo4URumRBvs1KF1mFEZOYhK/UJjGrJdTlILWbRRt+bkFWawEJ78440zMDYbIVNJ2wiORZg4kJcoTAiGoUjExMF8LRbLZ4sVJroRMnivN5vNUlmW0s0NXgYA2vvoqrak2A0zAoF9nV4v+Cs3nkAqeSoiri3sz6NeA2PZgmsVA9A2EBEfB3wcV9R9PKzIROs/DCWcveM7olwdIkp4HxICAiP6AUP72HJ0SKRYpF4HB0wLvWRGMHsgMlRBhKSI68zOQFOReFyeDBuUISn5QzLpC8kymeYkP0nLEAJcyWkxFPw/NcrNlnoSiiZEZan1stX52uTG9g5va0/S29WaWp1KSImH25sCstza3JKIW5s69baVoYyvuYluzoZvthuuSb5FVbAyKbx+OQRwer18IqzULQSlSdFLiroBE7qqiL1TK8GsKSUEE/Umoapiw6RI4laMl2evLhu9f7lN3Brv8p1R/9H5dE1WllOyU4uVM9/CAQRDoZwTiBL1jNfpdV3A1w/HvD6PelK8FXxznVKsMckCW0UqXDmpPF3K2ixSJrR028S3barDuYGl9B6o4fMMmbqqQrOTnnQ/ZzI2EtIqnGqNXYYCV4QpdtjSfh/tA2woNLm0ifmjdP1U25LKsRW7V9zitdo7/iU/UpH/0f2ud0G/60ilywW8YAndCBpqqta4q+oWWgqClCLIlKVs0PC7qwmpHthrCIpZWePKzh987UTJZ4XcOrBg7MNCbRU9o+QrA7jz6kg1ffv8eoYBNODoAMvSdBdovDrqpu9wz4X7zubWNdS/wS7ckRv87dzLs5Lf7AX1Y04uV3WFu99V8cBonXT6wNsjw8/HgrHw9vcl87mIPvzmwJ/nkycqahY8QV3+oelMUvyQWBQJj+7bta3788Bj8bOfPd72EXfu5MDIITv70vR5i86JF985cHhH1VZpaS3ZLu06avjfs/tJT+3XO7hDH7+4u37PrOAzm9WtX7qPpf/a+OlDu49sf+uYkH12eGTJz6e2rZ957PUTs59quEu+5+55l36dMWfbxdze4Pk52XtfCR/9ovGTwaGB45vndj19/8htB/ev8B+cHf5u/+9o8dCFnz449eMfJvlt4xA70NWwc6j1++5A7NLg4Y6teza9kDtdx0+/rD84fNIfVo7sO/7VGaZu2i8XlmfWdD5ZIY/Gz1Yzr+5XCun7GzVEIenwEQAA';
const appId='Juliodel-Applianc-PRD-9eeb1c253-dc2d635f';
const certId='PRD-eeb1c2538382-e09c-4490-b6d4-2fe8';
const eBay = require('ebay-node-client')(appId, certId);
const fse = require('fs-extra');
const objtoxml = require('./objtoxml');
const ebayitem = require('./ebayitem');

eBay.setApiKey(appId, certId);
//eBay.setUserToken(userToken);
eBay.setContentLanguage('en-US');
eBay.setMarketplaceId('EBAY_US');

async function getData(){
    eBay.setUserToken(userToken);
    let result;

    var epId = '1300568638';
    try {
        var response = await eBay.catalog.getProduct(epId);
        //console.log('response', response);
        result = response;
    } catch (error) {
        //console.log('error', error);
        result = error;
    }
    return result;
}

async function addEbayItemFile() {
    let result;
    try {
        var content = fse.readFileSync(__dirname + '/sample.xml', 'UTF-8');
         console.log('content', content);
        var response = await eBay.trading.addItem({content: content});
        console.log('response', response);
        result=response;
    } catch (error) {
        console.log('error ', error);
        result=error;
    }
    return result;
};

function convertObjToXml() {
    let obj = { 
        '?xml version=\"1.0\" encoding=\"iso-8859-1\"?' : null,
        request : {
          '@' : {
            type : 'product',
            id : 12344556
          },
          '#' : {
            query : {
              vendor : 'redhat',
              name : 'linux'
            }
          }
        }
    };
    return objtoxml.convertObjToXml(obj);
    /*
    ////
    <PackageDepth unit="inches">2</PackageDepth>
    ////
    result: 
    <?xml version="1.0" encoding="iso-8859-1"?>
    <request type="product" id="12344556">
    <query>
        <vendor>redhat</vendor>
        <name>linux</name>
    </query>
    </request>
    */
};

async function getEbayItem(){
    eBay.setToken(userToken);
    var itemId = 'v1|144347617737|0';
    try {
        var response = await eBay.browse.getItem(itemId);
        console.log('response', response);
        return response;
    } catch (error) {
        console.log('error', error);
        return error;
    }
}

async function createEbayItem(part, pics){
    let ebayitemxml = objtoxml.convertObjToXml(ebayitem.createEbayItem(part, pics, userToken));
    console.log(ebayitemxml);
    let result;
        await eBay.trading.addItem({content: ebayitemxml})
        .then((response)=>{
            console.log('response', response);
            result=response;    
        })
        .catch( (error)=>{
            console.log('error ', error);
            result=error;
        });
    return result;    
}

async function createEbayItemOld(part, pics){
    let ebayitemxml = objtoxml.convertObjToXml(ebayitem.createEbayItem(part, pics, userToken));
    console.log(ebayitemxml);
    let result;
    try {
        //eBay.setUserToken(userToken);
        //eBay.setToken(appToken);
        var response = await eBay.trading.addItem({content: ebayitemxml});
        console.log('response', response);
        result=response;
    } catch (error) {
        console.log('error ', error);
        result=error;
    }
    return result;    
}

async function reviseEbayItem(part, pics, ebayid){
    let ebayitemxml = objtoxml.convertObjToXml(ebayitem.reviseEbayItem(part, pics, userToken, ebayid));
    console.log('ebayid',ebayid);
    console.log(ebayitemxml);
    let result;
    try {
        var response = await eBay.trading.reviseItem({content: ebayitemxml});
        console.log('response', response);
        result=response;
    } catch (error) {
        console.log('error ', error);
        result=error;
    }
    return result;    
}

module.exports = {
    createEbayItem:
    function (part, pics){
        return createEbayItem(part, pics);
    },
    reviseEbayItem:
    function (part, pics, ebayid){
        return reviseEbayItem(part, pics, ebayid);
    },
}

/*
        "RequesterCredentials": {
            "eBayAuthToken": "v^1.1#i^1#p^3#I^3#f^0#r^0#t^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"
         },
*/